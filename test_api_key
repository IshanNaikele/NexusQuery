import os
import getpass
from dotenv import load_dotenv
from pinecone import Pinecone, ServerlessSpec

# Load environment variables from .env file
load_dotenv()

# Get API key from environment
pinecone_api_key = os.getenv("PINECONE_API_KEY")

if not pinecone_api_key:
    print("Pinecone API key not found. Please set it in your .env file.")
else:
    try:
        # Initialize Pinecone Client
        pc = Pinecone(api_key=pinecone_api_key)
        print("Pinecone client initialized successfully.")
        
        # Define your index name and dimension
        index_name = "nexus-query-index"
        embedding_dim = 768  # For sentence-transformers/all-mpnet-base-v2

        # Check if the index exists. Correctly call the .names() method
        if index_name not in pc.list_indexes().names():
            print(f"Index '{index_name}' does not exist. Creating it now...")
            pc.create_index(
                name=index_name,
                dimension=embedding_dim,
                metric="cosine",
                spec=ServerlessSpec(cloud='aws', region='us-east-1')
            )
            print(f"Index '{index_name}' created successfully!")
        else:
            print(f"Index '{index_name}' already exists.")

    except Exception as e:
        print(f"Failed to connect to Pinecone: {e}")